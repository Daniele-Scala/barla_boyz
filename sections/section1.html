<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Data Visualization Project</title>

    <link rel="stylesheet" href="../css/styles.css">    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="../js/barchart_1.js"></script>
</head>

<body class="bg-light d-flex flex-column min-vh-100">
  <nav class="navbar navbar-expand-lg navbar-light bg-success">
      <div class="container">
          <a class="navbar-brand" href="#">
              <img src="../Photo/logo.jpg" alt="Logo" height="60"> <!-- Ingrandito il logo -->
              <a class="nav-link" href="../"><strong>Barla Boyz</strong></a> <!-- Testo in rilievo -->
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav ml-auto">
                  <li class="nav-item">
                      <a class="nav-link" href="section1.html"><strong>Section 1</strong></a> <!-- Testo in rilievo -->
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="section2.html"><strong>Section 2</strong></a> <!-- Testo in rilievo -->
                  </li>
              </ul>
          </div>
      </div>
  </nav>

  <div class="container text-center flex-grow-1 my-5"> <!-- Aggiunto "flex-grow-1" per far crescere il div e "my-5" per aggiungere spazio sopra e sotto -->
      <div class="row">
          <h2>Grafico a Barre per il Numero di Alberi</h2>
          <select id="city-selector">
              <label for="dataset-dropdown"  style="margin-left: 10px;">Select City:</label>
          </select>
      </div>
  </div>

  <div id="bar-chart"></div>

  <script>
      d3.json("../Data/dataset1.json").then(function(data) {
          console.log(data); // Add this line for debugging
        var citySelector = d3.select("#city-selector");
        var cities = [...new Set(data.map(d => d.city))];
    
        citySelector
          .selectAll("option")
          .data(cities)
          .enter()
          .append("option")
          .attr("value", d => d)
          .text(d => d);
    
        function updateBarChart(city) {
          var filteredData = data.filter(d => d.city === city);
          var treeCounts = {};
    
          filteredData.forEach(function(d) {
            if (treeCounts[d.scientific_name]) {
              treeCounts[d.scientific_name] += d.count;
            } else {
              treeCounts[d.scientific_name] = d.count;
            }
          });
    
          var svg = d3.select("#bar-chart");
          svg.html(""); // Clear the previous content
    
          var margin = { top: 20, right: 20, bottom: 30, left: 40 };
          var width = 800 - margin.left - margin.right;
          var height = 400 - margin.top - margin.bottom;
    
          var chart = svg.append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
          var y = d3.scaleBand()
            .range([0, width])
            .padding(0.1)
            .domain(Object.keys(treeCounts));
    
          var x = d3.scaleLinear()
            .range([height, 0])
            .domain([0, d3.max(Object.values(treeCounts))]);
    
          chart.selectAll(".bar")
            .data(Object.entries(treeCounts))
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", d => x(d[0]))
            .attr("y", d => y(d[1]))
            .attr("width", x.bandwidth())
            .attr("height", d => height - y(d[1]));
    
          chart.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));
    
          chart.append("g")
            .call(d3.axisLeft(y));
        }
    
        updateBarChart(cities[0]);
    
        citySelector.on("change", function() {
          var selectedCity = this.value;
          updateBarChart(selectedCity);
        });
      });
  </script>

  <footer class="bg-dark text-light text-center p-2">
    <p>&copy; 2023 Barla Boyz. Tutti i diritti riservati. <a href="privacy.html" class="text-light">Informativa sulla privacy</a></p>
  </footer>
    
</body>
</html>